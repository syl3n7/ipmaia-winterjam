<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPMAIA WinterJam - Admin Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Authentication Overlay -->
    <div id="auth-overlay" class="auth-overlay" style="display: none;">
        <div class="auth-card">
            <div class="auth-header">
                <h1>üîê Admin Login</h1>
                <p>Authenticate to access the admin dashboard</p>
            </div>
            
            <div class="auth-buttons">
                <button class="btn auth-btn" onclick="loginWithOIDC()">
                    üîë Login with OIDC
                </button>
            </div>
            
            <div style="margin-top: 20px; text-align: center; opacity: 0.7; font-size: 0.9rem;">
                <p>üîí Secure authentication via OIDC only</p>
                <p>Contact admin if you need access</p>
            </div>
        </div>
    </div>

    <div class="container" id="admin-content">
        <div class="header">
            <h1>üéÆ Painel de Administra√ß√£o IPMAIA WinterJam</h1>
            <p>Sistema de Gest√£o de Conte√∫do Completo</p>
            <div id="user-info" class="user-info"></div>
            <div id="status" class="status info" style="margin-top: 15px;">A carregar estado do sistema...</div>
        </div>

        <!-- Navigation -->
        <div class="nav">
            <button class="nav-btn active" data-section="gamejams">üéÆ Game Jams</button>
            <button class="nav-btn" data-section="games">üéØ Jogos</button>
            <button class="nav-btn" data-section="users">üë• Utilizadores</button>
            <button class="nav-btn" data-section="frontpage">üè† P√°gina Inicial</button>
            <button class="nav-btn" data-section="rules">üìã Regras</button>
            <button class="nav-btn" data-section="system">‚öôÔ∏è Sistema</button>
        </div>

        <!-- Game Jams Section -->
        <div id="gamejams-section" class="card active">
            <h2>üéÆ Gest√£o de Game Jams</h2>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="btn btn-success" id="add-gamejam-btn">+ Adicionar Nova Game Jam</button>
                <button class="btn btn-primary" id="export-all-btn" style="margin-left: auto;">üì• Exportar Todos os Dados</button>
                <button class="btn btn-primary" id="import-data-btn">üì§ Importar Dados</button>
            </div>
            
            <!-- Hidden file input for import -->
            <input type="file" id="import-file-input" accept=".json" style="display: none;" />
            
            <div id="gamejam-form" class="form-section" style="display: none;">
                <h3>üìù Add/Edit Game Jam</h3>
                <form id="gamejam-form-element">
                    <div class="grid">
                        <div class="form-group">
                            <label for="jam-name">Name *</label>
                            <input type="text" id="jam-name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="jam-slug">Slug (URL √∫nico)</label>
                            <input type="text" id="jam-slug" name="slug" placeholder="winterjam-2025-dec">
                            <small>Identificador √∫nico para URL do arquivo. Ex: winterjam-2025-dec</small>
                        </div>
                    </div>

                    <div class="grid">
                        <div class="form-group">
                            <label for="jam-theme">Theme *</label>
                            <input type="text" id="jam-theme" name="theme" required>
                        </div>
                        <div class="form-group">
                            <label for="jam-archive-url">Archive URL</label>
                            <input type="text" id="jam-archive-url" name="archive_url" placeholder="/archive/2025/winter/winterjam-2025-dec">
                            <small>URL completo do arquivo. Ex: /archive/2025/winter/winterjam-2025-dec</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="jam-description">Description</label>
                        <textarea id="jam-description" name="description" placeholder="Describe the game jam..."></textarea>
                    </div>
                    
                    <div class="grid">
                        <div class="form-group">
                            <label for="jam-start">Start Date & Time *</label>
                            <input type="datetime-local" id="jam-start" name="start_date" required>
                        </div>
                        <div class="form-group">
                            <label for="jam-end">End Date & Time *</label>
                            <input type="datetime-local" id="jam-end" name="end_date" required>
                        </div>
                    </div>
                    
                    <div class="grid">
                        <div class="form-group">
                            <label for="jam-reg-start">Registration Start</label>
                            <input type="datetime-local" id="jam-reg-start" name="registration_start_date">
                        </div>
                        <div class="form-group">
                            <label for="jam-reg-end">Registration End</label>
                            <input type="datetime-local" id="jam-reg-end" name="registration_end_date">
                        </div>
                    </div>
                    
                    <div class="grid">
                        <div class="form-group">
                            <label for="jam-reg-url">Registration URL</label>
                            <input type="url" id="jam-reg-url" name="registration_url" placeholder="https://forms.microsoft.com/...">
                        </div>
                        <div class="form-group">
                            <label for="jam-rules-pdf">Rules PDF URL (relative or absolute)</label>
                            <input type="text" id="jam-rules-pdf" name="rules_pdf_url" placeholder="/WinterJam_Rulebook.pdf or https://example.com/rules.pdf">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="jam-banner">Banner Image URL (relative or absolute)</label>
                        <input type="text" id="jam-banner" name="banner_image_url" placeholder="/images/banner.jpg or https://example.com/banner.jpg">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="jam-active" name="is_active" checked>
                            Active Game Jam
                        </label>
                    </div>
                    
                    <!-- Homepage Content Section -->
                    <div style="border-top: 2px solid #667eea; margin-top: 30px; padding-top: 30px;">
                        <h4 style="color: #667eea; margin-bottom: 20px;">Homepage Content</h4>
                        <p style="color: #6c757d; margin-bottom: 20px; font-size: 0.9rem;">
                            Customize the content for the homepage sections. Leave blank to use default content.
                        </p>
                        
                        <div class="form-group">
                            <label for="jam-introduction">Introduction Text (optional)</label>
                            <textarea id="jam-introduction" name="introduction" rows="4" placeholder="A game jam where game development students and enthusiasts come together to create unique experiences in 45 hours..."></textarea>
                            <small>Plain text for the "What is WinterJam?" section on the homepage</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="jam-prizes">Prizes Text (optional)</label>
                            <textarea id="jam-prizes" name="prizes_content" rows="6" placeholder="1st Place: InstantGaming 10‚Ç¨ gift card (per member) + Certificate&#10;2nd Place: TBD&#10;&#10;All Participants: Event lanyard/keychain + Certificate"></textarea>
                            <small>Text content for the "Prizes" section on the homepage. Leave blank to use default prizes.</small>
                        </div>
                        
                        <div style="background: #f8f9ff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin: 20px 0;">
                            <h5 style="color: #667eea; margin-bottom: 10px;">Preview: Schedule Section</h5>
                            <p style="color: #6c757d; font-size: 0.9rem; margin-bottom: 10px;">This section is auto-generated from the Start Date and End Date fields above. It will automatically show:</p>
                            <div style="font-size: 0.85rem; color: #495057;">
                                <strong>Day 1 (Start Date):</strong> Event start time + Theme reveal (15 min later)<br>
                                <strong>Final Day (End Date):</strong> Event end time + Evaluation
                            </div>
                        </div>
                    </div>
                    
                    <!-- Toggle Controls Section -->
                    <div style="border-top: 2px solid #667eea; margin-top: 30px; padding-top: 30px;">
                        <h4 style="color: #667eea; margin-bottom: 20px;">üëÅÔ∏è Visibility Controls</h4>
                        
                        <div class="grid">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-theme" name="show_theme" checked>
                                    Show Theme
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-description" name="show_description" checked>
                                    Show Description
                                </label>
                            </div>
                        </div>
                        
                        <div class="grid">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-start-date" name="show_start_date" checked>
                                    Show Start Date
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-end-date" name="show_end_date" checked>
                                    Show End Date
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="date-fallback">When dates are disabled, show:</label>
                            <select id="date-fallback" name="date_fallback">
                                <option value="TBD">TBD (To Be Determined)</option>
                                <option value="Coming Soon">Coming Soon</option>
                                <option value="To Be Announced">To Be Announced</option>
                                <option value="hidden">Hide Completely</option>
                            </select>
                        </div>
                        
                        <div class="grid">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-registration-dates" name="show_registration_dates" checked>
                                    Show Registration Dates
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="registration-date-fallback">Registration date fallback:</label>
                                <select id="registration-date-fallback" name="registration_date_fallback">
                                    <option value="TBD">TBD</option>
                                    <option value="Coming Soon">Coming Soon</option>
                                    <option value="hidden">Hide Completely</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-registration-url" name="show_registration_url" checked>
                                    Show Registration URL
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-rules-pdf-url" name="show_rules_pdf_url" checked>
                                    Show Rules PDF URL
                                </label>
                            </div>
                        </div>
                        
                        <div class="grid">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-banner-image" name="show_banner_image" checked>
                                    Show Banner Image
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="banner-fallback">When banner is disabled, show:</label>
                                <select id="banner-fallback" name="banner_fallback">
                                    <option value="placeholder">Placeholder</option>
                                    <option value="hide">Hide Completely</option>
                                    <option value="default">Default Background</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button type="submit" class="btn btn-success">üíæ Save Game Jam</button>
                        <button type="button" class="btn" id="cancel-gamejam-btn">‚ùå Cancel</button>
                    </div>
                </form>
            </div>
            
            <div id="gamejams-list">
                <div class="loading">Loading game jams...</div>
            </div>
        </div>

        <!-- Games Section -->
        <div id="games-section" class="card">
            <h2>üéØ Games Management</h2>
            
            <button class="btn btn-success" id="add-game-btn">+ Add New Game</button>
            
            <div id="game-form" style="display: none; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                <h3>Add/Edit Game</h3>
                <form id="game-form-element">
                    <div class="grid">
                        <div class="form-group">
                            <label for="game-title">Game Title *</label>
                            <input type="text" id="game-title" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="game-jam-select">Game Jam *</label>
                            <select id="game-jam-select" name="game_jam_id" required>
                                <option value="">Select a game jam...</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="game-description">Description</label>
                        <textarea id="game-description" name="description" placeholder="Describe the game..."></textarea>
                    </div>
                    
                    <div class="grid">
                        <div class="form-group">
                            <label for="game-team-name">Team Name *</label>
                            <input type="text" id="game-team-name" name="team_name" required>
                        </div>
                        <div class="form-group">
                            <label for="game-team-members">Team Members (comma-separated)</label>
                            <input type="text" id="game-team-members" name="team_members" placeholder="Alice Silva, Bob Santos">
                        </div>
                    </div>
                    
                    <div class="grid">
                        <div class="form-group">
                            <label for="game-github">GitHub URL</label>
                            <input type="url" id="game-github" name="github_url" placeholder="https://github.com/...">
                        </div>
                        <div class="form-group">
                            <label for="game-itch">Itch.io URL</label>
                            <input type="url" id="game-itch" name="itch_url" placeholder="https://example.itch.io/game">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="game-tags">Tags (comma-separated)</label>
                        <input type="text" id="game-tags" name="tags" placeholder="adventure, puzzle, 2d">
                    </div>
                    
                    <div class="form-group">
                        <label for="game-thumbnail">Thumbnail URL (relative or absolute)</label>
                        <input type="text" id="game-thumbnail" name="thumbnail_url" placeholder="/images/game-thumb.jpg or https://example.com/thumbnail.jpg">
                    </div>
                    
                    <div class="form-group">
                        <label for="game-instructions">Instructions</label>
                        <textarea id="game-instructions" name="instructions" placeholder="How to play..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="game-lore">Lore/Story</label>
                        <textarea id="game-lore" name="lore" placeholder="Game backstory..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="game-ranking">Ranking</label>
                        <input type="number" id="game-ranking" name="ranking" placeholder="1">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="game-featured" name="is_featured">
                            Featured Game
                        </label>
                    </div>
                    
                    <!-- Toggle Controls Section -->
                    <div style="border-top: 2px solid #667eea; margin-top: 30px; padding-top: 30px;">
                        <h4 style="color: #667eea; margin-bottom: 20px;">üëÅÔ∏è Visibility Controls</h4>
                        
                        <div class="grid">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-title" name="show_title" checked>
                                    Show Title
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-description" name="show_description" checked>
                                    Show Description
                                </label>
                            </div>
                        </div>
                        
                        <div class="grid">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-team-name" name="show_team_name" checked>
                                    Show Team Name
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-team-members" name="show_team_members" checked>
                                    Show Team Members
                                </label>
                            </div>
                        </div>
                        
                        <div class="grid">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-github-url" name="show_github_url" checked>
                                    Show GitHub URL
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-itch-url" name="show_itch_url" checked>
                                    Show Itch.io URL
                                </label>
                            </div>
                        </div>
                        
                        <div class="grid">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-screenshots" name="show_screenshots" checked>
                                    Show Screenshots
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="screenshot-fallback">When screenshots are disabled:</label>
                                <select id="screenshot-fallback" name="screenshot_fallback">
                                    <option value="placeholder">Show Placeholder</option>
                                    <option value="hide">Hide Completely</option>
                                    <option value="default">Default Image</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-tags" name="show_tags" checked>
                                    Show Tags
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-thumbnail" name="show_thumbnail" checked>
                                    Show Thumbnail
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="thumbnail-fallback">When thumbnail is disabled:</label>
                            <select id="thumbnail-fallback" name="thumbnail_fallback">
                                <option value="placeholder">Show Placeholder</option>
                                <option value="hide">Hide Completely</option>
                                <option value="default">Default Image</option>
                            </select>
                        </div>
                        
                        <div class="grid">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-instructions" name="show_instructions" checked>
                                    Show Instructions
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="show-lore" name="show_lore" checked>
                                    Show Lore
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="show-ranking" name="show_ranking" checked>
                                Show Ranking
                            </label>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button type="submit" class="btn btn-success">üíæ Save Game</button>
                        <button type="button" class="btn" id="cancel-game-btn">‚ùå Cancel</button>
                    </div>
                </form>
            </div>
            
            <div id="games-list">
                <div class="loading">Loading games...</div>
            </div>
        </div>

        <!-- Users Section -->
        <div id="users-section" class="card">
            <h2>üë• Users Management</h2>
            <div class="info status">
                User management functionality coming soon...
            </div>
        </div>

        <!-- Front Page Section -->
        <div id="frontpage-section" class="card">
            <h2>üè† P√°gina Inicial - Imagem de Banner</h2>
            <p style="margin-bottom: 30px; color: #6c757d;">
                Carregue e gerencie a imagem de fundo da p√°gina inicial.
            </p>
            
            <div id="frontpage-loading" class="info status">A carregar configura√ß√µes...</div>
            
            <div id="frontpage-content" style="display: none;">
                <!-- Banner Image Upload Section -->
                <div id="current-banner-info" style="background: #f8f9ff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 30px;">
                    <h3 style="margin-bottom: 15px; color: #667eea;">Imagem Atual</h3>
                    <div id="banner-status">
                        <p style="color: #6c757d;">A carregar...</p>
                    </div>
                </div>
                
                <form id="banner-upload-form" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="banner-image-file">Carregar Nova Imagem</label>
                        <input type="file" id="banner-image-file" name="image" accept="image/jpeg,image/jpg,image/png,image/webp" required style="padding: 10px; border: 2px dashed #667eea; border-radius: 8px; background: #f8f9ff;" />
                        <small>Formatos permitidos: JPG, PNG, WebP. Tamanho m√°ximo: 5MB</small>
                    </div>
                    
                    <div class="form-actions" style="margin-top: 20px;">
                        <button type="submit" class="btn btn-primary">üì§ Carregar Imagem</button>
                    </div>
                </form>
                
                <!-- Hidden form for backend compatibility - keeps existing settings functionality working -->
                <form id="frontpage-form" style="display: none;">
                    <div class="settings-section">
                        <div id="hero-settings"></div>
                    </div>
                    <div class="settings-section">
                        <div id="general-settings"></div>
                    </div>
                    <div class="settings-section">
                        <div id="buttons-settings"></div>
                    </div>
                    <div class="settings-section">
                        <div id="advanced-settings"></div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Rules Section -->
        <div id="rules-section" class="card">
            <h2>Rules Management</h2>
            <p style="margin-bottom: 30px; color: #6c757d;">
                Upload or replace the WinterJam rulebook PDF. Only one rulebook is stored at a time.
            </p>
            
            <div id="current-rules-info" style="background: #f8f9ff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 30px;">
                <h3 style="margin-bottom: 15px; color: #667eea;">Current Rulebook</h3>
                <div id="rules-status">
                    <p style="color: #6c757d;">Loading...</p>
                </div>
            </div>
            
            <form id="rules-form-element" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="rules-pdf-file">Upload New PDF</label>
                    <input type="file" id="rules-pdf-file" name="pdf" accept=".pdf" required style="padding: 10px; border: 2px dashed #667eea; border-radius: 8px; background: #f8f9ff;" />
                    <small>The PDF will be available at: <strong>https://ipmaia-winterjam.pt/WinterJam_Rulebook.pdf</strong></small>
                </div>
                
                <div class="form-actions" style="margin-top: 20px;">
                    <button type="submit" class="btn btn-primary">Upload PDF</button>
                </div>
            </form>
        </div>
            </div>
        </div>

        <!-- System Section -->
        <div id="system-section" class="card">
            <h2>‚öôÔ∏è System Information</h2>
            
            <div class="grid">
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h3>üîß Quick Actions</h3>
                    <button class="btn" onclick="testHealth()">Health Check</button>
                    <button class="btn" onclick="testAPI()">Test API</button>
                    <button class="btn btn-danger" onclick="clearCache()">Clear Cache</button>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h3>üìä Statistics</h3>
                    <div id="stats">Loading stats...</div>
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <h3>üîó API Endpoints</h3>
                <ul style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <li><strong>Health:</strong> GET /health</li>
                    <li><strong>Game Jams:</strong> GET /api/public/gamejams</li>
                    <li><strong>Games:</strong> GET /api/public/games/featured</li>
                    <li><strong>Search:</strong> GET /api/public/games/search?q=term</li>
                    <li><strong>Archive:</strong> GET /api/public/archive/2025</li>
                </ul>
            </div>
            
            <div id="system-response" style="margin-top: 20px;">
                <h3>üìù System Response</h3>
                <pre id="response" style="background: #f8f9fa; padding: 15px; border-radius: 10px; min-height: 100px;">System ready...</pre>
            </div>
        </div>
    </div>

    <script src="admin.js"></script>
</body>
</html>